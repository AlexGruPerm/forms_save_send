import logging
import psycopg2
import sys
import pprint


# INFO (если выставлен уровень INFO, то debug сообщения не выводятся)
#  DEBUG

logging.basicConfig(format = u'%(filename)s[LINE:%(lineno)d]# %(levelname)-8s [%(asctime)s]  %(message)s', level = logging.DEBUG)

def main():
    # Define our connection string
    conn_string = "host='10.242.5.62' dbname='db_ris_mkrpk' user='prm_salary' password='prm_salary'"
    py_pg_app_name ="form_save_valid_tester"

    # print the connection string we will use to connect
    logging.debug("Connecting to database\n	->%s" % (conn_string))

    # get a connection, if a connect cannot be made an exception will be raised here
    conn = psycopg2.connect(conn_string)
    logging.debug("type(conn)= "+str(type(conn)))
    cur = conn.cursor()
    cur.execute("set application_name TO '"+py_pg_app_name+"'; ")

    '''
    cur.execute("SELECT distinct application_name from pg_stat_activity")
    records = cur.fetchall()
    pprint.pprint(records)
    '''

    bv_user_id = int(8599398) #615
    bv_input_period_id = 0
    bv_report_id = 0 # достаем форму из среднего стакана.
    l_frms_status_1 = 0 #count of forms in status=1 На заполнении

    #==================================================================================================================
    # open ZP main page. List of calls.

    # get periods list and take last one
    cur.execute("BEGIN; SELECT * FROM prm_salary.pkg_web_salary_form_input_period_list(refcur => 'qwe');")

    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        logging.debug(str(row_count)+" "+str(row,))
        bv_input_period_id=int(row[0])
    cur_res.close()
    logging.debug("--------------------------------------------------------------")
    logging.info("Use last row from periods :  bv_input_period_id="+str(bv_input_period_id))
    logging.debug("--------------------------------------------------------------")


    #==================================================================================================================
    # get forms count by status
    cur.execute("BEGIN; SELECT * FROM prm_salary.pkg_web_salary_form_status_list(refcur            => 'qwe', "
                                                                                "p_input_period_id => %(p_input_period_id)s, "
                                                                                "p_user_id         => %(p_user_id)s);",
                                                                                {'p_input_period_id': bv_input_period_id,
                                                                                 'p_user_id':bv_user_id})
    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        logging.debug(str(row_count) + " " + str(row, ))
        if (row[0]==1 and row[4] is not None):
            l_frms_status_1 = int(row[4])
    cur_res.close()
    if l_frms_status_1>0:
        logging.info("Count of forms in 1 status : "+str(l_frms_status_1))
    else:
        logging.error("There are no forms in 1 status, exit(0)")
        exit(0)

    logging.debug("--------------------------------------------------------------")

    cur.execute("BEGIN; SELECT * FROM prm_salary.pkg_web_salary_form_get_period_close_date(refcur => 'qwe');")
    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        logging.debug(str(row_count) + " " + str(row, ))
    cur_res.close()
    logging.debug("--------------------------------------------------------------")

    cur.execute("BEGIN; SELECT * FROM prm_salary.pkg_web_salary_form_okved_list(refcur            => 'qwe', "
                                                                               "p_input_period_id => %(p_input_period_id)s);",
                                                                               {'p_input_period_id': bv_input_period_id})
    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        logging.debug(str(row_count) + " " + str(row, ))
    cur_res.close()
    logging.debug("--------------------------------------------------------------")

    cur.execute("BEGIN; SELECT * FROM prm_salary.pkg_web_salary_form_oiv_list(refcur            => 'qwe', "
                                                                             "p_input_period_id => %(p_input_period_id)s, "
                                                                             "p_user_id         => %(p_user_id)s);",
                                                                             {'p_input_period_id': bv_input_period_id,
                                                                              'p_user_id': bv_user_id})
    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        logging.debug(str(row_count) + " " + str(row, ))
    cur_res.close()
    logging.debug("--------------------------------------------------------------")

    cur.execute("BEGIN; SELECT * FROM prm_salary.pkg_web_salary_form_territory_list(refcur            => 'qwe', "
                                                                                   "p_input_period_id => %(p_input_period_id)s );",
                                                                                   {'p_input_period_id': bv_input_period_id})
    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        logging.debug(str(row_count) + " " + str(row, ))
    cur_res.close()
    logging.debug("--------------------------------------------------------------")

    #==================================================================================================================
    # get list of forms for this user.
    cur.execute("begin; select * from prm_salary.pkg_web_salary_form_report_list(refcur => 'qwe',"
                          "p_input_period_id     => %(p_input_period_id)s,"
                          "p_user_id             => %(p_user_id)s,"
                          "P_FORM_TYPE_LIST      => '{\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"-1\"}',"
                          "P_OIV_LIST            => '{\"2\",\"69394\",\"69395\",\"69396\",\"69398\",\"69399\",\"69400\",\"69401\",\"69402\",\"69403\",\"69404\",\"69405\",\"69406\",\"69407\",\"69408\",\"69409\",\"69410\",\"69412\",\"69413\",\"69414\",\"69415\",\"69416\",\"69417\",\"69418\",\"69419\",\"69420\",\"69421\",\"69422\",\"69423\",\"69424\",\"69426\",\"69428\",\"69429\",\"69430\",\"69432\",\"69433\",\"69434\",\"69435\",\"69437\",\"69438\",\"69439\",\"69440\",\"69441\",\"69442\",\"69443\",\"69444\",\"69445\",\"69446\",\"69447\",\"69448\",\"69449\",\"69451\",\"69452\",\"69453\",\"69454\",\"69455\",\"69456\",\"69457\",\"69458\",\"69459\",\"69460\",\"69461\",\"69462\",\"69463\",\"69464\",\"69465\",\"69466\",\"69467\",\"69469\",\"69470\",\"69471\",\"69472\",\"69473\",\"69474\",\"69476\",\"69477\",\"69478\",\"69479\",\"69480\",\"69482\",\"69483\",\"69484\",\"69485\",\"69486\",\"69487\",\"69488\",\"69489\",\"69490\",\"69491\",\"69492\",\"69493\",\"69494\",\"69495\",\"69496\",\"69497\",\"69499\",\"69500\",\"69502\",\"69503\",\"69504\",\"69505\",\"69506\",\"69507\",\"69508\",\"69509\",\"69510\",\"69511\",\"69513\",\"69514\",\"69515\",\"69516\",\"69517\",\"69518\",\"69519\",\"69520\",\"69521\",\"69523\",\"69524\",\"69525\",\"69526\",\"69527\",\"69528\",\"69530\",\"69531\",\"69532\",\"69533\",\"69534\",\"69535\",\"69536\",\"69537\",\"69538\",\"69539\",\"69540\",\"69541\",\"69542\",\"69543\",\"69544\",\"69545\",\"69546\",\"69547\",\"69548\",\"69550\",\"69551\",\"69554\",\"69555\",\"69556\",\"69557\",\"69558\",\"69559\",\"69560\",\"69562\",\"69563\",\"69564\",\"69565\",\"69566\",\"69567\",\"69568\",\"69569\",\"69570\",\"69571\",\"69572\",\"69573\",\"69574\",\"69575\",\"69576\",\"69577\",\"69578\",\"69579\",\"69580\",\"69581\",\"69583\",\"69584\",\"69585\",\"69587\",\"69588\",\"69589\",\"69590\",\"69591\",\"69592\",\"69593\",\"69594\",\"69596\",\"69597\",\"69598\",\"69599\",\"69600\",\"69601\",\"69602\",\"69603\",\"69604\",\"69607\",\"69608\",\"69609\",\"69610\",\"69611\",\"69612\",\"69613\",\"69614\",\"69615\",\"69616\",\"69617\",\"69618\",\"69619\",\"69620\",\"69622\",\"69623\",\"69624\",\"69625\",\"69628\",\"69630\",\"69631\",\"69632\",\"69633\",\"69634\",\"69635\",\"69636\",\"69637\",\"69638\",\"69639\",\"69640\",\"69642\",\"69643\",\"69644\",\"69645\",\"69646\",\"69647\",\"69648\",\"69649\",\"69650\",\"69651\",\"69652\",\"69653\",\"69655\",\"69656\",\"69657\",\"69658\",\"69660\",\"69662\",\"69663\",\"69664\",\"69665\",\"69666\",\"69667\",\"69668\",\"69669\",\"69670\",\"69671\",\"69672\",\"69673\",\"69675\",\"69676\",\"69677\",\"69678\",\"69679\",\"69680\",\"69681\",\"69682\",\"69683\",\"69684\",\"69685\",\"69686\",\"69687\",\"69688\",\"69689\",\"69690\",\"69691\",\"69692\",\"69693\",\"69694\",\"69695\",\"69697\",\"69698\",\"69699\",\"69700\",\"69701\",\"69702\",\"69704\",\"69705\",\"69706\",\"69707\",\"69708\",\"69709\",\"69710\",\"69711\",\"69712\",\"69713\",\"69715\",\"69716\",\"69717\",\"69718\",\"69719\",\"69720\",\"69721\",\"69722\",\"69723\",\"69724\",\"69725\",\"69726\",\"69727\",\"69729\",\"69730\",\"69731\",\"69732\",\"69733\",\"69734\",\"69735\",\"69736\",\"69737\",\"69738\",\"69739\",\"69740\",\"69743\",\"69744\",\"69745\",\"69746\",\"69747\",\"69748\",\"69749\",\"69750\",\"69751\",\"69752\",\"69753\",\"69754\",\"69755\",\"69756\",\"69757\",\"69758\",\"69759\",\"69760\",\"69761\",\"69762\",\"69763\",\"69764\",\"69765\",\"69767\",\"69768\",\"69769\",\"69770\",\"69771\",\"69772\",\"69773\",\"69775\",\"69776\",\"69777\",\"69778\",\"69779\",\"69780\",\"69781\",\"69782\",\"69783\",\"69784\",\"69785\",\"69788\",\"69789\",\"69791\",\"69792\",\"69793\",\"69794\",\"69795\",\"69796\",\"69797\",\"69798\",\"69801\",\"69802\",\"69803\",\"69804\",\"69805\",\"69806\",\"69807\",\"69808\",\"69809\",\"69811\",\"69812\",\"69813\",\"69815\",\"69816\",\"69817\",\"69818\",\"69819\",\"69820\",\"69821\",\"69822\",\"69823\",\"69824\",\"69826\",\"69827\",\"69828\",\"69829\",\"69831\",\"69832\",\"69833\",\"69834\",\"69835\",\"69836\",\"69837\",\"69838\",\"69839\",\"69840\",\"69841\",\"69842\",\"69843\",\"69844\",\"69845\",\"69846\",\"69847\",\"69848\",\"69849\",\"69850\",\"69851\",\"69852\",\"69855\",\"69856\",\"69857\",\"69858\",\"69859\",\"69860\",\"69862\",\"69863\",\"69864\",\"69865\",\"69867\",\"69868\",\"69869\",\"69870\",\"69871\",\"69872\",\"69873\",\"69874\",\"69875\",\"69877\",\"69879\",\"69880\",\"69881\"}',"
                          "P_OKVED_LIST          => '{\"35\",\"36\",\"37\",\"38\",\"41\",\"42\",\"43\",\"45\",\"49\",\"50\",\"52\",\"53\",\"55\",\"56\",\"58\",\"59\",\"60\",\"62\",\"63\",\"64\",\"66\",\"68\",\"69\",\"70\",\"71\",\"72\",\"73\",\"74\",\"75\",\"78\",\"80\",\"81\",\"82\",\"84\",\"85\",\"86\",\"87\",\"88\",\"90\",\"91\",\"93\",\"96\",\"01\",\"01.61\",\"02\",\"02.1\",\"02.10\",\"02.40\",\"02.40.1\",\"35.12\",\"35.30\",\"35.30.14\",\"36.0\",\"36.00\",\"36.00.2\",\"37.00\",\"38.1\",\"41.2\",\"41.20\",\"42.21\",\"43.99\",\"43.99.9\",\"45.20\",\"49.3\",\"49.31\",\"49.31.2\",\"49.31.22\",\"49.41\",\"49.41.2\",\"50.30\",\"52.10\",\"52.10.4\",\"52.21\",\"52.21.2\",\"52.21.22\",\"52.21.24\",\"53.10\",\"53.10.4\",\"53.10.9\",\"55.20\",\"55.90\",\"56.29\",\"58.13\",\"59.1\",\"59.13\",\"59.14\",\"60.10\",\"62.02\",\"63.11\",\"63.11.1\",\"63.91\",\"64.99\",\"64.99.3\",\"66.19\",\"66.19.6\",\"68.10\",\"68.10.12\",\"68.20\",\"68.20.2\",\"68.3\",\"68.32\",\"68.32.1\",\"68.32.2\",\"69.10\",\"69.20\",\"69.20.2\",\"70.22\",\"71.1\",\"71.11\",\"71.11.1\",\"71.12\",\"71.12.1\",\"71.12.2\",\"71.12.4\",\"71.12.41\",\"71.12.46\",\"71.12.53\",\"72.19\",\"72.20\",\"73.20\",\"73.20.1\",\"74.20\",\"75.00\",\"75.00.1\",\"75.00.2\",\"78.10\",\"78.20\",\"80.10\",\"80.3\",\"80.30\",\"81.10\",\"81.29\",\"81.29.2\",\"81.29.9\",\"82.11\",\"82.19\",\"82.99\",\"84.1\",\"84.11\",\"84.11.22\",\"84.11.3\",\"84.11.31\",\"84.11.35\",\"84.11.4\",\"84.11.8\",\"84.12\",\"84.13\",\"84.22\",\"84.25\",\"84.25.1\",\"84.25.9\",\"85.11\",\"85.12\",\"85.13\",\"85.14\",\"85.21\",\"85.22\",\"85.23\",\"85.41\",\"85.41.1\",\"85.41.2\",\"85.41.9\",\"85.42\",\"85.42.9\",\"86.1\",\"86.10\",\"86.21\",\"86.22\",\"86.23\",\"86.90\",\"86.90.1\",\"86.90.2\",\"86.90.4\",\"86.90.9\",\"87.3\",\"87.30\",\"87.9\",\"87.90\",\"88.1\",\"88.10\",\"88.91\",\"88.99\",\"90.0\",\"90.01\",\"90.03\",\"90.04\",\"90.04.2\",\"90.04.3\",\"91.0\",\"91.01\",\"91.02\",\"91.03\",\"91.04\",\"93.1\",\"93.11\",\"93.12\",\"93.19\",\"93.2\",\"93.21\",\"93.29\",\"93.29.2\",\"93.29.9\",\"96.0\",\"96.03\",\"96.04\"}',"
                          "P_REORGANIZATION_LIST => '{\"1\",\"2\"}',"
                          "P_TERRITORY_LIST      => '{\"57000000000\",\"57605000000\",\"57605105000\",\"57605105001\",\"57612000000\",\"57612101000\",\"57612101001\",\"57614000000\",\"57614101000\",\"57614101001\",\"57616000000\",\"57616101000\",\"57616101001\",\"57616157000\",\"57616157126\",\"57620000000\",\"57620422000\",\"57620422206\",\"57623000000\",\"57623101000\",\"57623101001\",\"57624000000\",\"57624428000\",\"57624428101\",\"57627000000\",\"57627101000\",\"57627101001\",\"57638000000\",\"57638422000\",\"57638422141\",\"57640000000\",\"57640101000\",\"57640101001\",\"57642000000\",\"57642101000\",\"57642101001\",\"57642410000\",\"57642410101\",\"57646000000\",\"57646402000\",\"57646402101\",\"57646402106\",\"57646405000\",\"57646405101\",\"57646405106\",\"57646407000\",\"57646407101\",\"57646409000\",\"57646409101\",\"57646412000\",\"57646412101\",\"57646412106\",\"57646412116\",\"57646413000\",\"57646413101\",\"57646413111\",\"57646413241\",\"57646413261\",\"57646419000\",\"57646419101\",\"57646419151\",\"57646437000\",\"57646437101\",\"57646440000\",\"57646440101\",\"57646443000\",\"57646443101\",\"57646448000\",\"57646448101\",\"57646448106\",\"57646448116\",\"57646448136\",\"57646453000\",\"57646453101\",\"57646453151\",\"57646458000\",\"57646458101\",\"57646458126\",\"57646461000\",\"57646461101\",\"57646464000\",\"57646464101\",\"57646470000\",\"57646470101\",\"57646472000\",\"57646472101\",\"57646472181\",\"57650000000\",\"57650431000\",\"57650431111\",\"57654000000\",\"57654101000\",\"57654101001\",\"57657000000\",\"57657101000\",\"57657101001\",\"57658000000\",\"57658101000\",\"57658101001\",\"57701000000\",\"57701000001\",\"57708000000\",\"57708000001\",\"57717000000\",\"57717000001\",\"57722000000\",\"57722000001\",\"57726000000\",\"57726000001\",\"57730000000\",\"57730000001\",\"57827000000\",\"57827428000\",\"57827428101\",\"57851000000\",\"57851000001\",\"57604000000\",\"57604403000\",\"57604403101\",\"57604407000\",\"57604407101\",\"57604410000\",\"57604410101\",\"57604410111\",\"57604413000\",\"57604413101\",\"57604416000\",\"57604416101\",\"57604419000\",\"57604419101\",\"57604425000\",\"57604425106\",\"57604431000\",\"57604431101\",\"57604437000\",\"57604437101\",\"57604437106\",\"57604437116\",\"57604440000\",\"57604440101\",\"57604441000\",\"57604441101\",\"57604441106\",\"57604449000\",\"57604449101\",\"57605105116\",\"57605154000\",\"57605154051\",\"57605154141\",\"57605154146\",\"57605154166\",\"57605158000\",\"57605158051\",\"57605401000\",\"57605401101\",\"57606000000\",\"57606402000\",\"57606402101\",\"57606404000\",\"57606404101\",\"57606410000\",\"57606410101\",\"57606413000\",\"57606413101\",\"57606425000\",\"57606425101\",\"57606431000\",\"57606431101\",\"57606431126\",\"57606431151\",\"57606432000\",\"57606432101\",\"57606432151\",\"57608000000\",\"57608407000\",\"57608407101\",\"57608407111\",\"57608407116\",\"57608410000\",\"57608410101\",\"57608410111\",\"57608413000\",\"57608413101\",\"57608428000\",\"57608428101\",\"57608431000\",\"57608431101\",\"57608431106\",\"57608431111\",\"57608431141\",\"57608437000\",\"57608437101\",\"57608440000\",\"57608440101\",\"57612404000\",\"57612404101\",\"57612404141\",\"57612407000\",\"57612407101\",\"57612407166\",\"57612409000\",\"57612409101\",\"57612409126\",\"57612411000\",\"57612411101\",\"57612411106\",\"57612425000\",\"57612425101\",\"57612425106\",\"57612425136\",\"57612428000\",\"57612428271\",\"57614401000\",\"57614401051\",\"57614401056\",\"57614402000\",\"57614402051\",\"57614403000\",\"57614403051\",\"57614403106\",\"57614404000\",\"57614404051\",\"57614406000\",\"57614406056\",\"57615000000\",\"57615101000\",\"57615101001\",\"57615458000\",\"57615458101\",\"57616101111\",\"57616157051\",\"57616403000\",\"57616403101\",\"57616403126\",\"57616404000\",\"57616404101\",\"57616404136\",\"57616406000\",\"57616406101\",\"57616406156\",\"57616411000\",\"57616411131\",\"57616425000\",\"57616425101\",\"57616425221\",\"57616428000\",\"57616428101\",\"57616428161\",\"57616428176\",\"57618000000\",\"57618402000\",\"57618402101\",\"57618402131\",\"57618402146\",\"57618404000\",\"57618404101\",\"57618407000\",\"57618407101\",\"57618407131\",\"57618407141\",\"57618416000\",\"57618416101\",\"57618419000\",\"57618419101\",\"57620104000\",\"57620104001\",\"57620401000\",\"57620401101\",\"57620401116\",\"57620401156\",\"57620401236\",\"57620402000\",\"57620402101\",\"57620402161\",\"57620404000\",\"57620404101\",\"57620422101\",\"57620434000\",\"57620434101\",\"57620434191\",\"57620440000\",\"57622000000\",\"57622410000\",\"57622410101\",\"57622410211\",\"57622413000\",\"57622413101\",\"57622416000\",\"57622416101\",\"57622416156\",\"57622419000\",\"57622419101\",\"57622422000\",\"57622422101\",\"57622422171\",\"57622425000\",\"57622425101\",\"57622425111\",\"57622434000\",\"57622434101\",\"57622434131\",\"57622434156\",\"57623456000\",\"57623456101\",\"57623458000\",\"57623458101\",\"57623460000\",\"57623460101\",\"57623462000\",\"57623462101\",\"57624402000\",\"57624402101\",\"57624405000\",\"57624405101\",\"57624413000\",\"57624419000\",\"57624419101\",\"57626000000\",\"57626101000\",\"57626101001\",\"57626407000\",\"57626407101\",\"57626407106\",\"57626413000\",\"57626413101\",\"57626413111\",\"57626413156\",\"57626413171\",\"57626416000\",\"57626416101\",\"57626440000\",\"57626440101\",\"57626440131\",\"57627154000\",\"57627154051\",\"57627154161\",\"57627405000\",\"57627405101\",\"57627405131\",\"57627408000\",\"57627408101\",\"57628000000\",\"57628407000\",\"57628407101\",\"57628410000\",\"57628410101\",\"57628410131\",\"57628410136\",\"57628413000\",\"57628413101\",\"57628416000\",\"57628416101\",\"57628416136\",\"57628426000\",\"57628426101\",\"57628426136\",\"57628426151\",\"57628428000\",\"57628428101\",\"57628431000\",\"57628431101\",\"57628431111\",\"57628440000\",\"57628440101\",\"57628440126\",\"57628446000\",\"57628446101\",\"57628446116\",\"57628446126\",\"57628449000\",\"57628449101\",\"57628449116\",\"57628449126\",\"57630000000\",\"57630404000\",\"57630404101\",\"57630407000\",\"57630407101\",\"57630407106\",\"57630410000\",\"57630410101\",\"57630410106\",\"57630416000\",\"57630416101\",\"57630416181\",\"57630428000\",\"57630428101\",\"57630429000\",\"57630429101\",\"57630431000\",\"57630431101\",\"57630434000\",\"57630434101\",\"57630434151\",\"57630437000\",\"57630437101\",\"57630437111\",\"57630438000\",\"57630438101\",\"57630438141\",\"57630440000\",\"57630440101\",\"57630443000\",\"57630443101\",\"57630446000\",\"57630446101\",\"57630449000\",\"57630449101\",\"57630455000\",\"57630455101\",\"57630455136\",\"57630458000\",\"57630458101\",\"57630461000\",\"57630461101\",\"57630461111\",\"57630464000\",\"57630464101\",\"57630464106\",\"57630465000\",\"57630465101\",\"57630465131\",\"57634000000\",\"57634101000\",\"57634101001\",\"57634101106\",\"57634101111\",\"57634153000\",\"57634157000\",\"57634157051\",\"57634404000\",\"57634404101\",\"57634404116\",\"57634404186\",\"57634404201\",\"57634407000\",\"57634407101\",\"57634407106\",\"57634410000\",\"57634410101\",\"57634410146\",\"57634428000\",\"57634428101\",\"57634428106\",\"57634428121\",\"57634431000\",\"57634431101\",\"57634431176\",\"57636000000\",\"57636151000\",\"57636151051\",\"57636151116\",\"57636151126\",\"57636156000\",\"57636156051\",\"57636156111\",\"57636403000\",\"57636403101\",\"57636403111\",\"57636404000\",\"57636404101\",\"57636404106\",\"57636404116\",\"57636404121\",\"57636410000\",\"57636410101\",\"57636410121\",\"57636413000\",\"57636413101\",\"57636413111\",\"57636415000\",\"57636415101\",\"57636415121\",\"57636422000\",\"57636422101\",\"57636422116\",\"57636425000\",\"57636425101\",\"57636428000\",\"57636428101\",\"57636428106\",\"57636437000\",\"57636437101\",\"57636443000\",\"57636443101\",\"57636460000\",\"57636460101\",\"57636460131\",\"57638402000\",\"57638402101\",\"57638413000\",\"57638413101\",\"57638416000\",\"57638416101\",\"57638428000\",\"57638428101\",\"57640404000\",\"57640404101\",\"57640413000\",\"57640413101\",\"57640414000\",\"57640414101\",\"57640419000\",\"57640419101\",\"57640422000\",\"57640422101\",\"57640428000\",\"57640428101\",\"57640431000\",\"57640431101\",\"57640434000\",\"57640434131\",\"57642402000\",\"57642402101\",\"57642407000\",\"57642407101\",\"57642410121\",\"57642414000\",\"57642414101\",\"57642417000\",\"57642417101\",\"57642420000\",\"57642420101\",\"57642420141\",\"57642425000\",\"57642425101\",\"57644000000\",\"57644101000\",\"57644101001\",\"57644154000\",\"57644154051\",\"57644407000\",\"57644407101\",\"57644419000\",\"57644419101\",\"57644419146\",\"57644425000\",\"57644425101\",\"57648000000\",\"57648402000\",\"57648402101\",\"57648402111\",\"57648404000\",\"57648404101\",\"57648404211\",\"57648404216\",\"57648430000\",\"57648434000\",\"57648434101\",\"57648434256\",\"57648434276\",\"57648434341\",\"57650416000\",\"57650416101\",\"57650416121\",\"57650419000\",\"57650419106\",\"57650428000\",\"57650428101\",\"57650428126\",\"57650428141\",\"57650431101\",\"57650432000\",\"57650432101\",\"57650432131\",\"57650432136\",\"57650440000\",\"57650443000\",\"57650443101\",\"57651000000\",\"57651151000\",\"57651151051\",\"57651410000\",\"57651410101\",\"57651410131\",\"57651410136\",\"57651416000\",\"57651416101\",\"57651416116\",\"57651416136\",\"57651416181\",\"57651422000\",\"57651422101\",\"57651422136\",\"57651422186\",\"57651422191\",\"57651422211\",\"57652000000\",\"57652402000\",\"57652402101\",\"57652402131\",\"57652404000\",\"57652404101\",\"57652404106\",\"57652404121\",\"57652410000\",\"57652410101\",\"57652412000\",\"57652412101\",\"57652414000\",\"57652414101\",\"57652416000\",\"57652416101\",\"57652420000\",\"57652420101\",\"57653000000\",\"57653101000\",\"57653101001\",\"57653101311\",\"57653101316\",\"57653101331\",\"57653412000\",\"57653412101\",\"57653428000\",\"57653428101\",\"57653432000\",\"57653432101\",\"57654402000\",\"57654402101\",\"57654404000\",\"57654404101\",\"57654406000\",\"57654406101\",\"57654413000\",\"57654413101\",\"57654413106\",\"57654416000\",\"57654416101\",\"57654419000\",\"57654419101\",\"57654425000\",\"57654425101\",\"57654428000\",\"57654428101\",\"57655000000\",\"57655402000\",\"57655402101\",\"57655402136\",\"57655416000\",\"57655416101\",\"57655416111\",\"57655425000\",\"57655425101\",\"57655425131\",\"57655425156\",\"57655428000\",\"57655428101\",\"57655428131\",\"57655428136\",\"57655428146\",\"57655428156\",\"57656000000\",\"57656101000\",\"57656101001\",\"57656157000\",\"57656157051\",\"57656402000\",\"57656402101\",\"57656407000\",\"57656407101\",\"57656424000\",\"57656424101\",\"57656434000\",\"57656434101\",\"57656434141\",\"57656446000\",\"57656446101\",\"57656446146\",\"57656452000\",\"57656452101\",\"57657101106\",\"57657404000\",\"57657404101\",\"57657404116\",\"57657410000\",\"57657410101\",\"57657413000\",\"57657413101\",\"57657413116\",\"57657416000\",\"57657416101\",\"57657425000\",\"57657425101\",\"57657431000\",\"57657431101\",\"57657436000\",\"57657436101\",\"57657436136\",\"57657437000\",\"57657437101\",\"57657439000\",\"57657439101\",\"57657440000\",\"57657440101\",\"57657443000\",\"57657443101\",\"57657446000\",\"57657446141\",\"57657449000\",\"57657449101\",\"57657451000\",\"57657451101\",\"57657451126\",\"57658101056\",\"57658402000\",\"57658402101\",\"57658410000\",\"57658410101\",\"57658413000\",\"57658413101\",\"57658454000\",\"57658454101\",\"57658456000\",\"57658456051\",\"57658458000\",\"57658458101\",\"57658462000\",\"57658462051\",\"57717000056\",\"57726000176\",\"57726000231\",\"57726000241\",\"57726000276\",\"57726000281\",\"57726000301\",\"57726000316\",\"57726000356\",\"57726000366\",\"57726000371\",\"57763000000\",\"57763000051\",\"57814000000\",\"57814403000\",\"57814403101\",\"57814403106\",\"57814405000\",\"57814405101\",\"57814405191\",\"57814409000\",\"57814409101\",\"57814409126\",\"57814412000\",\"57814412101\",\"57814412111\",\"57814421000\",\"57814421101\",\"57814424000\",\"57814424101\",\"57814424106\",\"57814429000\",\"57814429101\",\"57817000000\",\"57817404000\",\"57817404101\",\"57817404106\",\"57819000000\",\"57819404000\",\"57819408000\",\"57819408101\",\"57819408221\",\"57819410000\",\"57819410101\",\"57819412000\",\"57819412101\",\"57819420000\",\"57819420101\",\"57819420146\",\"57821000000\",\"57821404000\",\"57821404101\",\"57821404291\",\"57821408000\",\"57821408101\",\"57821408341\",\"57821414000\",\"57821414101\",\"57821414136\",\"57821414221\",\"57821428000\",\"57821428101\",\"57821428156\",\"57821428226\",\"57821428321\",\"57821436000\",\"57821436101\",\"57821444000\",\"57821444101\",\"57821444106\",\"57821444186\",\"57821444266\",\"57825000000\",\"57825418000\",\"57825418101\",\"57825418106\",\"57825420000\",\"57825420101\",\"57825420146\",\"57825420176\",\"57825426000\",\"57825426101\",\"57825426121\",\"57825426266\",\"57825426306\",\"57825426351\",\"57825426411\",\"57827408000\",\"57827408101\",\"57827408156\",\"57827408261\",\"57827416000\",\"57827416101\",\"57827416156\",\"57827416201\",\"57827416246\",\"57827417000\",\"57827417101\",\"57827421000\",\"57827421101\",\"57827428291\",\"57614405000\",\"57622410186\",\"57626407126\",\"57634153051\",\"57646448126\",\"57646453136\",\"57654414000\"}',"
                          "P_STATUS_LIST         => '{\"1\",\"4\",\"5\",\"3\",\"9\",\"6\",\"7\",\"8\"}',"
                          "P_USE_FILTER          => '{\"1\",\"5\",\"2\",\"3\",\"4\"}',"
                          "p_string_filter       => '',"
                          "p_first_row           => 1,"
                          "p_last_row            => 9999999999);",
                          {'p_input_period_id': bv_input_period_id,
                          'p_user_id':          bv_user_id}
             )

    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        logging.debug(str(row_count) + " " + str(row, ))
        bv_report_id = int(row[0])
    cur_res.close()
    if bv_report_id > 0:
        logging.info("Selected report_id  : " + str(bv_report_id))
    else:
        logging.error("There are no forms in 1 status, exit(0)")
        exit(0)
    logging.debug("--------------------------------------------------------------")

    #==================================================================================================================
    # get form data with bind variable - p_report_id
    # bv_report_id = 43944
    cur.execute("BEGIN; SELECT * FROM prm_salary.pkg_web_salary_form_get_data(refcur      => 'qwe', "
                                                                             "p_report_id => %(p_report_id)s, "
                                                                             "p_for_day   => '01.01.3000 05:04:21');",
                {'p_report_id': bv_report_id})


    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        logging.debug(str(row_count) + " " + str(row, ))
    cur_res.close()
    logging.debug("--------------------------------------------------------------")
    #==================================================================================================================
    # get button permission
    cur.execute("BEGIN; SELECT * FROM prm_salary.pkg_web_salary_form_get_button_permission(refcur      => 'qwe', "
                                                                                          "p_report_id => %(p_report_id)s,"
                                                                                          "p_user_id   => %(p_user_id)s);",
                {'p_report_id': bv_report_id, 'p_user_id':bv_user_id})
    cur_res = conn.cursor('qwe')
    row_count = 0
    for row in cur_res:
        row_count += 1
        #print(row_count, " ", row)
        logging.debug(str(row_count) + " " + str(row, ))
    cur_res.close()
    logging.debug("--------------------------------------------------------------")
    #==================================================================================================================

    cur.execute("select pg_sleep(10)")
    # conn.cursor will return a cursor object, you can use this cursor to perform queries
    #cursor = conn.cursor()

main()